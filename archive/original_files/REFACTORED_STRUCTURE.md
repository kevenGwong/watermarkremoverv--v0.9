# ğŸ—ï¸ é‡æ„åçš„é¡¹ç›®ç»“æ„

```
watermark_remover_ai/
â”œâ”€â”€ ğŸ“ core/                          # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ ğŸ“ models/                    # AIæ¨¡å‹å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_model.py            # æ¨¡å‹åŸºç±»
â”‚   â”‚   â”œâ”€â”€ florence_detector.py     # Florence-2æ£€æµ‹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ custom_segmenter.py      # è‡ªå®šä¹‰åˆ†å‰²æ¨¡å‹
â”‚   â”‚   â””â”€â”€ lama_inpainter.py        # LaMAä¿®å¤æ¨¡å‹
â”‚   â”œâ”€â”€ ğŸ“ processors/               # å¤„ç†ç®¡é“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ watermark_processor.py   # ä¸»å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ image_processor.py       # å›¾åƒå¤„ç†
â”‚   â”‚   â””â”€â”€ mask_processor.py        # æ©ç å¤„ç†
â”‚   â””â”€â”€ ğŸ“ utils/                    # æ ¸å¿ƒå·¥å…·
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ image_utils.py           # å›¾åƒå¤„ç†å·¥å…·
â”‚       â”œâ”€â”€ mask_utils.py            # æ©ç å¤„ç†å·¥å…·
â”‚       â”œâ”€â”€ config_utils.py          # é…ç½®ç®¡ç†
â”‚       â””â”€â”€ florence_utils.py        # Florence-2ä¸“ç”¨å·¥å…·
â”œâ”€â”€ ğŸ“ interfaces/                    # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ ğŸ“ web/                      # Webç•Œé¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“ frontend/             # å‰ç«¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ streamlit_app.py     # Streamlitä¸»åº”ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/       # UIç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parameter_panel.py    # å‚æ•°æ§åˆ¶é¢æ¿
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ image_comparison.py   # å›¾åƒå¯¹æ¯”ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ download_buttons.py   # ä¸‹è½½æŒ‰é’®ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ layouts/          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ main_layout.py        # ä¸»å¸ƒå±€
â”‚   â”‚   â”‚       â””â”€â”€ sidebar_layout.py     # ä¾§è¾¹æ å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ ğŸ“ backend/              # åç«¯API
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ api_routes.py        # APIè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ request_handler.py   # è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“ services/             # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ processing_service.py     # å¤„ç†æœåŠ¡
â”‚   â”‚       â””â”€â”€ file_service.py           # æ–‡ä»¶æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ cli/                      # å‘½ä»¤è¡Œç•Œé¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ cli_app.py               # CLIåº”ç”¨
â”‚   â””â”€â”€ ğŸ“ gui/                      # æ¡Œé¢GUI
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ qt_app.py                # Qtåº”ç”¨
â”œâ”€â”€ ğŸ“ config/                       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py                  # åº”ç”¨è®¾ç½®
â”‚   â”œâ”€â”€ default_config.yaml          # é»˜è®¤é…ç½®
â”‚   â””â”€â”€ ğŸ“ environments/             # ç¯å¢ƒé…ç½®
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ development.yaml         # å¼€å‘ç¯å¢ƒ
â”‚       â””â”€â”€ production.yaml          # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ ğŸ“ data/                         # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ ğŸ“ models/                   # æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ temp/                     # ä¸´æ—¶æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“ output/                   # è¾“å‡ºæ–‡ä»¶
â”œâ”€â”€ ğŸ“ tests/                        # æµ‹è¯•æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ğŸ“ unit/                     # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_models.py
â”‚   â”‚   â”œâ”€â”€ test_processors.py
â”‚   â”‚   â””â”€â”€ test_utils.py
â”‚   â”œâ”€â”€ ğŸ“ integration/              # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_web_interface.py
â”‚   â”‚   â””â”€â”€ test_processing_pipeline.py
â”‚   â””â”€â”€ ğŸ“ fixtures/                 # æµ‹è¯•æ•°æ®
â”œâ”€â”€ ğŸ“ scripts/                      # è„šæœ¬å’Œå·¥å…·
â”‚   â”œâ”€â”€ start_web.sh                 # Webå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start_cli.sh                 # CLIå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ ğŸ“ deployment/               # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ ğŸ“ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ API.md                       # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ DEPLOYMENT.md                # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ ğŸ“ development/              # å¼€å‘æ–‡æ¡£
â”œâ”€â”€ ğŸ“ archive/                      # å½’æ¡£æ–‡ä»¶
â”‚   â””â”€â”€ original_files/              # åŸå§‹æ–‡ä»¶å¤‡ä»½
â”œâ”€â”€ app.py                           # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt                 # Pythonä¾èµ–
â”œâ”€â”€ setup.py                         # å®‰è£…è„šæœ¬
â””â”€â”€ .gitignore                       # Gitå¿½ç•¥æ–‡ä»¶
```

## ğŸ¯ **æ¨¡å—èŒè´£åˆ’åˆ†**

### ğŸ“ **core/ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**

#### ğŸ“ **models/ - AIæ¨¡å‹å±‚**
- **base_model.py**: æ‰€æœ‰æ¨¡å‹çš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
- **florence_detector.py**: Florence-2æ£€æµ‹æ¨¡å‹å°è£…
- **custom_segmenter.py**: è‡ªå®šä¹‰åˆ†å‰²æ¨¡å‹å°è£…
- **lama_inpainter.py**: LaMAä¿®å¤æ¨¡å‹å°è£…

#### ğŸ“ **processors/ - å¤„ç†ç®¡é“**
- **watermark_processor.py**: ä¸»å¤„ç†å™¨ï¼Œåè°ƒå„ä¸ªç»„ä»¶
- **image_processor.py**: å›¾åƒé¢„å¤„ç†å’Œåå¤„ç†
- **mask_processor.py**: æ©ç ç”Ÿæˆå’Œå¤„ç†

#### ğŸ“ **utils/ - å·¥å…·å‡½æ•°**
- **image_utils.py**: å›¾åƒå¤„ç†å·¥å…·å‡½æ•°
- **mask_utils.py**: æ©ç å¤„ç†å·¥å…·å‡½æ•°
- **config_utils.py**: é…ç½®åŠ è½½å’Œç®¡ç†
- **florence_utils.py**: Florence-2ä¸“ç”¨å·¥å…·

### ğŸ“ **interfaces/ - ç”¨æˆ·ç•Œé¢å±‚**

#### ğŸ“ **web/ - Webç•Œé¢**
- **frontend/**: Streamlitå‰ç«¯ç»„ä»¶
- **backend/**: åç«¯APIæœåŠ¡
- **services/**: ä¸šåŠ¡æœåŠ¡å±‚

#### ğŸ“ **cli/ - å‘½ä»¤è¡Œç•Œé¢**
- **cli_app.py**: å‘½ä»¤è¡Œåº”ç”¨å…¥å£

#### ğŸ“ **gui/ - æ¡Œé¢GUI**
- **qt_app.py**: Qtæ¡Œé¢åº”ç”¨

### ğŸ“ **config/ - é…ç½®ç®¡ç†**
- **settings.py**: åº”ç”¨è®¾ç½®å’Œå¸¸é‡
- **default_config.yaml**: é»˜è®¤é…ç½®æ–‡ä»¶
- **environments/**: ä¸åŒç¯å¢ƒçš„é…ç½®

## ğŸ”§ **é‡æ„ä¼˜åŠ¿**

### âœ… **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
- **æ¨¡å‹å±‚**: çº¯AIæ¨¡å‹å®ç°ï¼Œæ— UIé€»è¾‘
- **å¤„ç†å±‚**: ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ— æ¨¡å‹ä¾èµ–
- **ç•Œé¢å±‚**: çº¯UIå®ç°ï¼Œæ— ä¸šåŠ¡é€»è¾‘
- **é…ç½®å±‚**: é›†ä¸­é…ç½®ç®¡ç†

### âœ… **æ˜“äºæ‰©å±•**
- æ–°æ¨¡å‹åªéœ€å®ç° `BaseModel` æ¥å£
- æ–°ç•Œé¢åªéœ€åœ¨ `interfaces/` ä¸‹æ·»åŠ 
- æ–°åŠŸèƒ½æ¨¡å—åŒ–ï¼Œä¸å½±å“å…¶ä»–éƒ¨åˆ†

### âœ… **ä¾¿äºæµ‹è¯•**
- æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•
- æ¸…æ™°çš„ä¾èµ–å…³ç³»
- æ¨¡æ‹Ÿæ¥å£ä¾¿äºå•å…ƒæµ‹è¯•

### âœ… **ç»´æŠ¤å‹å¥½**
- ç»Ÿä¸€çš„å‘½åè§„èŒƒ
- æ¸…æ™°çš„æ–‡æ¡£ç»“æ„
- æ¨¡å—åŒ–çš„é”™è¯¯å¤„ç†

## ğŸš€ **è¿ç§»è®¡åˆ’**

1. **ç¬¬ä¸€é˜¶æ®µ**: åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
2. **ç¬¬äºŒé˜¶æ®µ**: è¿ç§»æ ¸å¿ƒæ¨¡å— (core/)
3. **ç¬¬ä¸‰é˜¶æ®µ**: é‡æ„ç•Œé¢å±‚ (interfaces/)
4. **ç¬¬å››é˜¶æ®µ**: å®Œå–„é…ç½®å’Œæ–‡æ¡£
5. **ç¬¬äº”é˜¶æ®µ**: æ·»åŠ æµ‹è¯•å’Œéƒ¨ç½²è„šæœ¬

## ğŸ“‹ **å‘½åè§„èŒƒ**

### ğŸ·ï¸ **æ–‡ä»¶å‘½å**
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿: `watermark_processor.py`
- æè¿°æ€§åç§°: `florence_detector.py` è€Œä¸æ˜¯ `utils.py`
- æ¨¡å—åæ¸…æ™°è¡¨è¾¾åŠŸèƒ½

### ğŸ·ï¸ **ç±»å‘½å**
- ä½¿ç”¨PascalCase: `WatermarkProcessor`
- æè¿°æ€§åç§°: `FlorenceDetector`
- é¿å…ç¼©å†™: `ImageProcessor` è€Œä¸æ˜¯ `ImgProc`

### ğŸ·ï¸ **å‡½æ•°å‘½å**
- ä½¿ç”¨snake_case: `process_image()`
- åŠ¨è¯å¼€å¤´: `generate_mask()`, `load_model()`
- æè¿°æ€§åç§°: `convert_bbox_to_relative()`

### ğŸ·ï¸ **å˜é‡å‘½å**
- ä½¿ç”¨snake_case: `mask_threshold`
- é¿å…å•å­—æ¯å˜é‡: `image` è€Œä¸æ˜¯ `img`
- å¸¸é‡ä½¿ç”¨å¤§å†™: `MAX_FILE_SIZE` 